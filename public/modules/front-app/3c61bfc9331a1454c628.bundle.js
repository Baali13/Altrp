(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{609:function(e,t,r){"use strict";r.r(t);var n=r(3),i=r.n(n),s=r(4),a=r.n(s),o=r(9),u=r.n(o),c=r(12),l=r.n(c),d=r(16),h=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"POST",s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};i()(this,e),this.formId=t,this.fields=[],this.method=n,this.options=s,this.modelName=r;var a="/ajax/models/".concat(r);switch(r){case"login":a="/login";break;case"logout":a="/logout"}this.resource=new d.a({route:a})}var t;return a()(e,[{key:"setFields",value:function(e){this.fields=e}},{key:"addField",value:function(e){var t=!1;return this.fields=this.fields.map((function(r){return r.getId()===e.getId()?(t=!0,e.component?e:r):r})),t||this.fields.push(e),!0}},{key:"submit",value:(t=l()(u.a.mark((function e(t){var n,i,s,a,o=this,c=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:"",i=!0,!n){e.next=8;break}return e.next=5,confirm(n);case 5:if(e.sent){e.next=8;break}return e.abrupt("return",{success:!1});case 8:if(this.fields.forEach((function(e){e.fieldValidate()||(i=!1)})),!i){e.next=41;break}e.t0=this.method,e.next="POST"===e.t0?13:"PUT"===e.t0?26:"DELETE"===e.t0?34:39;break;case 13:return e.next=15,this.resource.post(this.getData());case 15:if(s=e.sent,"login"!==this.modelName||!this.options.afterLoginRedirect){e.next=19;break}return document.location.replace(this.options.afterLoginRedirect),e.abrupt("return",s);case 19:if("logout"!==this.modelName||!this.options.afterLogoutRedirect){e.next=22;break}return document.location.replace(this.options.afterLogoutRedirect),e.abrupt("return",s);case 22:if(!s.reload){e.next=25;break}return document.location.reload(),e.abrupt("return");case 25:return e.abrupt("return",s);case 26:if(!t){e.next=32;break}return e.next=29,this.resource.put(t,this.getData());case 29:return a=e.sent,Promise.resolve().then(r.bind(null,54)).then((function(e){e.default.updateModelWithData(o.modelName,t,o.getData())})),e.abrupt("return",a);case 32:return console.error("Не удалось получить ИД модели для удаления!"),e.abrupt("break",39);case 34:if(!t){e.next=38;break}return e.next=37,this.resource.delete(t);case 37:return e.abrupt("return",e.sent);case 38:console.error("Не удалось получить ИД модели для удаления!");case 39:e.next=44;break;case 41:return e.next=43,alert("Валидация не прошла");case 43:return e.abrupt("return",e.sent);case 44:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getData",value:function(){var e={altrp_ajax:!0};return this.fields.forEach((function(t){null!==t.getValue()&&(e[t.getSettings("field_id")]=t.getValue())})),e}}]),e}(),f=new(function(){function e(){i()(this,e),this.forms=[],this.formIds=[],this.fieldsStorage={}}return a()(e,[{key:"registerForm",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=this.getForm(e);return i||(i=new h(e,t,r,n),this.fieldsStorage[e]&&this.fieldsStorage[e].length&&(i.setFields(this.fieldsStorage[e]),delete this.fieldsStorage[e]),this.forms.push(i)),i}},{key:"addField",value:function(e,t){var r=this.getForm(e);return r?r.addField(t):(this.fieldsStorage[e]=this.fieldsStorage[e]||[],this.fieldsStorage[e].push(t),!0)}},{key:"submitForm",value:function(e,t){return this.getForm(e)?this.getForm(e).submit(t):(console.error("Форма не найдена"),!1)}},{key:"getForm",value:function(e){var t=null;return this.forms.forEach((function(r){r.formId===e&&(t=r)})),t}}]),e}());t.default=f}}]);
//# sourceMappingURL=3c61bfc9331a1454c628.bundle.js.map