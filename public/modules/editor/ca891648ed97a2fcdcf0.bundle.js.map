{"version":3,"sources":["webpack:///./resources/modules/editor/src/sass/altrp-pagination.scss?2657","webpack:///./resources/modules/editor/src/sass/altrp-pagination.scss?fb79","webpack:///./resources/modules/admin/src/components/AutoUpdateInput.js","webpack:///./resources/modules/editor/src/js/components/altrp-table/altrp-table.js"],"names":["module","exports","push","i","content","options","transform","undefined","update","locals","hot","accept","newContent","a","b","key","idx","Error","dispose","AutoUpdateInput","props","resource","Resource","route","state","value","disabled","changeValue","bind","onChange","onKeyDown","this","get","resourceid","res","setState","e","keyCode","newValue","target","_","isFunction","changevalue","put","column_value","className","inputProps","onBlur","Component","AltrpTable","settings","query","data","currentModel","tables_columns","length","children","useQuerySettings","forceFetchOnMount","refetchOnWindowFocus","defaultSortSettings","forEach","column","column_is_default_sorted","order_by","accessor","order","_status","_error","_latestData","useState","page","setPage","counter","getCounterStart","_data","updatedData","setUpdatedData","sortSetting","setSortSettings","filterSetting","setFilterSettings","doubleClicked","setDoubleClicked","filterSettingJSON","JSON","stringify","fetchModels","useCallback","queryData","assign","filters","console","log","getQueried","pageSize","usePaginatedQuery","dataSourceName","getParams","status","resolvedData","latestData","error","useEffect","hasMore","queryCache","prefetchQuery","useQuery","getResource","columns","_column","column_name","_accessor","settingsToColumns","isArray","map","row","id","rowId","useTable","React","useMemo","getTableProps","getTableBodyProps","headerGroups","rows","prepareRow","sortingHandler","filterHandler","filteredColumn","searchString","filterParams","additional_rows","additional_cells","cell","rowspan","colspan","role","colSpan","rowSpan","title","renderAdditionalRows","headerGroup","getHeaderGroupProps","headers","column_width","column_header_alignment","thProps","getHeaderProps","style","width","textAlign","column_is_sorted","onClick","thText","render","iconsManager","renderIcon","column_is_filtered","type","stopPropagation","renderTh","table_style_table_striple_style","message","getRowProps","table_hover_row","cells","_i","cellContent","linkTag","isEditor","Link","column_body_alignment","cellProps","getCellProps","_cellContent","doubleClickContent","column_is_editable","column_edit_url","columnEditUrl","parseURLTemplate","original","onDoubleClick","cellClassName","isObject","column_link","createElement","to","trim","paginationType","old","Math","max","prev_text","current_page_text","next_text"],"mappings":"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","file":"ca891648ed97a2fcdcf0.bundle.js","sourcesContent":["exports = module.exports = require(\"../../../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"\", \"\"]);\n\n// exports\n","\nvar content = require(\"!!../../../../../node_modules/css-loader/index.js!../../../../../node_modules/sass-loader/dist/cjs.js!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../../../node_modules/css-loader/index.js!../../../../../node_modules/sass-loader/dist/cjs.js!./altrp-pagination.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../../node_modules/css-loader/index.js!../../../../../node_modules/sass-loader/dist/cjs.js!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../../../node_modules/css-loader/index.js!../../../../../node_modules/sass-loader/dist/cjs.js!./altrp-pagination.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../../node_modules/css-loader/index.js!../../../../../node_modules/sass-loader/dist/cjs.js!../../../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../../../node_modules/css-loader/index.js!../../../../../node_modules/sass-loader/dist/cjs.js!./altrp-pagination.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","import React, {Component} from \"react\";\r\nimport Resource from \"../../../editor/src/js/classes/Resource\";\r\n\r\nclass AutoUpdateInput extends Component {\r\n  constructor(props){\r\n    super(props);\r\n    this.resource = new Resource({\r\n      route: this.props.route,\r\n    });\r\n\r\n    this.state = {\r\n      value: this.props.value || '',\r\n      disabled: ! this.props.value,\r\n    };\r\n    this.changeValue = this.changeValue.bind(this);\r\n    this.onChange = this.onChange.bind(this);\r\n    this.onKeyDown = this.onKeyDown.bind(this);\r\n  }\r\n  async componentDidMount(){\r\n    if(this.props.value !== undefined){\r\n      return;\r\n    }\r\n    let res = await this.resource.get(this.props.resourceid);\r\n    this.setState(state=>{\r\n      return{...state,\r\n        value: res[this.props.resourceid] || '',\r\n        disabled: false,\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * При нажатии на enter тоже обновдем данные\r\n   * @param e\r\n   */\r\n  onKeyDown(e){\r\n    if(e.keyCode === 13){\r\n      this.changeValue(e);\r\n    }\r\n  }\r\n\r\n  onChange(e){\r\n    let newValue = e.target.value;\r\n    this.setState(state=>{\r\n      return{...state,\r\n        value: newValue,\r\n      }\r\n    });\r\n    if(_.isFunction(this.props.changevalue)){\r\n      this.props.changevalue(newValue);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Запрос на именение поля\r\n   * @param e\r\n   * @return {Promise<void>}\r\n   */\r\n  async changeValue(e){\r\n    let newValue = e.target.value;\r\n    this.setState(state=>{\r\n      return{...state,\r\n        disabled: true,\r\n      }\r\n    });\r\n    let res = await this.resource.put(this.props.resourceid, {value: newValue, column_value: newValue});\r\n    this.setState(state=>{\r\n      return{...state,\r\n        disabled: false,\r\n      }\r\n    });\r\n  }\r\n  render(){\r\n    let {className} = this.props;\r\n    if(this.state.disabled){\r\n      className += ' pointer-event-none';\r\n    }\r\n    const inputProps = {...this.props};\r\n    delete inputProps.changevalue;\r\n    return<input{...inputProps} className={className}\r\n                onBlur={this.changeValue}\r\n                onKeyDown={this.onKeyDown}\r\n                onChange={this.onChange}\r\n                value={this.state.value}/>\r\n  }\r\n}\r\n\r\nexport default AutoUpdateInput","import React, {useCallback, useState, useEffect} from \"react\";\r\nimport {useTable, useSortBy} from \"react-table\";\r\nimport {useQuery, usePaginatedQuery, queryCache} from  \"react-query\";\r\nimport '../../../sass/altrp-pagination.scss';\r\nimport {Link} from \"react-router-dom\";\r\nimport {isEditor, parseURLTemplate} from \"../../../../../front-app/src/js/helpers\";\r\nimport {iconsManager} from \"../../../../../admin/src/js/helpers\";\r\nimport AutoUpdateInput from \"../../../../../admin/src/components/AutoUpdateInput\";\r\n\r\n/**\r\n *\r\n * @param settings\r\n * @param {Query} query\r\n * @param {{}} data\r\n * @param {AltrpModel} currentModel\r\n * @return {*}\r\n * @constructor\r\n */\r\nconst AltrpTable = ({settings, query, data, currentModel}) => {\r\n  if (! (settings.tables_columns && settings.tables_columns.length)) {\r\n    return <div children=\"Please Add Column\"/>\r\n  }\r\n  const useQuerySettings = {\r\n    forceFetchOnMount: true,\r\n    refetchOnWindowFocus: true,\r\n  };\r\n  /**\r\n   * проверим есть ли настройки для сортировок по умолчанию\r\n   */\r\n  const defaultSortSettings =  {};\r\n  settings.tables_columns.forEach(column => {\r\n    if(column.column_is_default_sorted && !defaultSortSettings.order_by){\r\n      defaultSortSettings.order_by = column.accessor;\r\n      defaultSortSettings.order = _.get(column, 'column_is_default_sorted_direction', 'ASC')\r\n    }\r\n  });\r\n  const [page, setPage] = useState(1);\r\n\r\n  let counter = query.getCounterStart(page);\r\n  let _data =[], _status, _error, _latestData;\r\n\r\n  const [updatedData, setUpdatedData] = useState({});\r\n  const [sortSetting, setSortSettings] = useState(defaultSortSettings);\r\n  const [filterSetting, setFilterSettings] = useState({});\r\n  const [doubleClicked, setDoubleClicked] =  useState({});\r\n  const filterSettingJSON = JSON.stringify(filterSetting);\r\n  const fetchModels = useCallback(async (key, page = 1, sortSetting, filterSetting) => {\r\n    let queryData = {page};\r\n    const filterSettingJSON = JSON.stringify(filterSetting);\r\n    if(sortSetting){\r\n      queryData = _.assign(sortSetting, queryData);\r\n    }\r\n    if(filterSettingJSON.length > 2){\r\n      queryData.filters = filterSettingJSON;\r\n    }\r\n    console.log(queryData);\r\n    return query.getQueried(queryData)\r\n  });\r\n  if(query.pageSize){\r\n    /**\r\n     * Если есть пагинация\r\n     */\r\n    const {\r\n      status,\r\n      resolvedData,\r\n      latestData,\r\n      error,\r\n    } = usePaginatedQuery([query.dataSourceName, page, sortSetting, filterSetting, query.getParams()],\r\n        fetchModels,\r\n        useQuerySettings);\r\n    _data = resolvedData ? resolvedData : _data;\r\n    _status = status;\r\n    _error = error;\r\n    _latestData = latestData;\r\n    useEffect(() => {\r\n      if (latestData?.hasMore) {\r\n        queryCache.prefetchQuery([query.dataSourceName, page + 1], fetchModels);\r\n      }\r\n    }, [latestData, fetchModels, page, sortSetting, filterSetting]);\r\n  }else {\r\n    /**\r\n     * Если нет пагинации\r\n     */\r\n    const {status, data, error,} = useQuery([query.dataSourceName,query.getParams()],\r\n        () => {\r\n      return query.getResource().getQueried({...sortSetting,filters: filterSettingJSON})\r\n    }, useQuerySettings);\r\n    _data = data;\r\n    _status = status;\r\n    _error = error;\r\n  }\r\n  let columns = [];\r\n  columns = settingsToColumns(settings);\r\n  if(! _data.length){\r\n    _data = data;\r\n  }\r\n  if(! _.isArray(_data)){\r\n    _data = [_data];\r\n  }\r\n  /**\r\n   * обновление данных при изменении ячейки\r\n   * @type {any[]}\r\n   * @private\r\n   */\r\n  _data = _data.map((row)=>{\r\n    if(row.id === updatedData.rowId){\r\n      row[updatedData.column] = updatedData.value;\r\n      return{...row};\r\n    }\r\n    return row;\r\n  });\r\n  let {\r\n    getTableProps,\r\n    getTableBodyProps,\r\n    headerGroups,\r\n    rows,\r\n    prepareRow,\r\n  } = useTable({\r\n    columns: React.useMemo(\r\n        () => (\r\n            columns || []\r\n        ),\r\n        [settings.tables_columns]\r\n    ),\r\n    data: React.useMemo(() => (_data || []), [_data]),\r\n  }, );\r\n  /**\r\n   * Обработка клика для сортировки\r\n   */\r\n  const sortingHandler = order_by => {\r\n    setSortSettings({\r\n    order_by, \r\n    order: sortSetting &&\r\n      (sortSetting.order_by === order_by) ? (sortSetting.order === \"DESC\" ? \"ASC\" :  \"DESC\") : \"ASC\"\r\n  });\r\n  };\r\n  /**\r\n   * Изменение поля для фильтрации\r\n   */\r\n  const filterHandler = (filteredColumn, searchString) => {\r\n    setPage(1);\r\n    const filterParams = {...filterSetting};\r\n    if(searchString){\r\n      filterParams[filteredColumn] = searchString;\r\n    } else {\r\n      delete filterParams[filteredColumn];\r\n    }\r\n    setFilterSettings(filterParams);\r\n  };\r\n  \r\n  return <><table className=\"altrp-table\" {...getTableProps()}>\r\n    <thead className=\"altrp-table-head\">\r\n    {renderAdditionalRows(settings)}\r\n    {headerGroups.map(headerGroup => (\r\n        <tr {...headerGroup.getHeaderGroupProps()} className=\"altrp-table-tr\">\r\n          {headerGroup.headers.map(column => {\r\n            return renderTh({column, sortSetting, sortingHandler, filterSetting, filterHandler});\r\n          }\r\n          )}\r\n        </tr>\r\n    ))}\r\n    </thead>\r\n    <tbody {...getTableBodyProps()} className={`altrp-table-tbody ${settings.table_style_table_striple_style ? ' altrp-table-tbody--striped' : ''}`}>\r\n    {_status === \"error\" ? <tr>\r\n              <td>{_error.message}</td>\r\n            </tr> : _status === \"loading\" ? <tr>\r\n              <td>Loading</td>\r\n            </tr>\r\n            : rows.map((row, i) => {\r\n              prepareRow(row);\r\n              return (\r\n                  <tr {...row.getRowProps()} className={`altrp-table-tr ${settings.table_hover_row ? 'altrp-table-background' : ''}`}>\r\n                    {row.cells.map((cell, _i) => {\r\n                      let cellContent = cell.render('Cell');\r\n                      let linkTag = isEditor() ? 'a': Link;\r\n                      const style = cell.column.column_body_alignment ? { textAlign: cell.column.column_body_alignment } : {};\r\n                      const cellProps = {...cell.getCellProps()};\r\n                      let _cellContent = cell.value;\r\n\r\n                      /**\r\n                       * Если в настройках колонки установлено редактирование и есть url запроса на редактирование\r\n                       * то добавляем особое поведение\r\n                       */\r\n                      let doubleClickContent = '';\r\n                      if(columns[_i].column_is_editable && columns[_i].column_edit_url){\r\n                        let columnEditUrl = parseURLTemplate(columns[_i].column_edit_url, row.original);\r\n\r\n                        doubleClickContent =\r\n                            <AutoUpdateInput className=\"altrp-inherit altrp-table-td__double-click-content\"\r\n                                             route={columnEditUrl}\r\n                                             resourceid={''}\r\n                                             changevalue={(value)=>{\r\n                                               setUpdatedData({\r\n                                                 value,\r\n                                                 rowId:row.original.id,\r\n                                                 column:columns[_i]._accessor\r\n                                               });\r\n                                             }}\r\n                                             value={_cellContent}/>;\r\n                        cellProps.onDoubleClick = () => {\r\n                          if(doubleClicked.column === columns[_i]._accessor && doubleClicked.rowId === row.original.id){\r\n                            setDoubleClicked({});\r\n                          } else {\r\n                            setDoubleClicked({\r\n                              column: columns[_i]._accessor,\r\n                              rowId: row.original.id,\r\n                            });\r\n                          }\r\n                        };\r\n                      }\r\n                      let cellClassName = 'altrp-table-td';\r\n                      if(doubleClicked.column === columns[_i]._accessor && row.original.id === doubleClicked.rowId){\r\n                        cellClassName += ' altrp-table-td_double-clicked';\r\n                      }\r\n                    /**\r\n                     * Если в настройках table_hover_row: false, - background для отдельной ячейки\r\n                     */\r\n                      if (!settings.table_hover_row) {\r\n                        cellClassName += ' altrp-table-background';\r\n                      }\r\n\r\n                      /**\r\n                       * Если значение объект или массив, то отобразим пустую строку\r\n                       */\r\n                      if(_.isObject(cell.value)){\r\n                        cellContent = '';\r\n                      }\r\n                      /**\r\n                       * Если в настройках колонки есть url, и в данных есть id, то делаем ссылку\r\n                       */\r\n                      if(columns[_i].column_link && row.original.id){\r\n                        cellContent = React.createElement(linkTag, {\r\n                          to: parseURLTemplate(columns[_i].column_link,  row.original),\r\n                          className: 'altrp-inherit altrp-table-td__default-content',\r\n                        }, cellContent)\r\n                      } else {\r\n                        cellContent = React.createElement('span', {\r\n                          className: 'altrp-inherit altrp-table-td__default-content',\r\n                        }, cellContent)\r\n                      }\r\n                      /**\r\n                       * Если нужно указать номер по порядку\r\n                       */\r\n                      if(cell.column._accessor.trim() === '##'){\r\n                        cellContent = counter++;\r\n                      }\r\n                      return <td {...cellProps} className={cellClassName} style={style}>\r\n                          {cellContent}{doubleClickContent}\r\n                        </td>\r\n                    })}\r\n                  </tr>\r\n              )\r\n            })}\r\n    </tbody>\r\n  </table>\r\n    {((query.paginationType === 'prev-next') && query.pageSize) ?\r\n      <div className=\"altrp-pagination\">\r\n        <button className={\"altrp-pagination__previous\"}\r\n                onClick={() => {\r\n                  setPage(old => Math.max(old - 1, 0));\r\n                  setDoubleClicked({});\r\n                  setUpdatedData({});\r\n                }}\r\n                disabled={page === 1}>\r\n          {settings.prev_text || 'Previous Page'}\r\n        </button>\r\n        <div className=\"altrp-pagination__count\">\r\n          {settings.current_page_text || 'Current Page:'}\r\n           {page}\r\n        </div>\r\n        <button className=\"altrp-pagination__next\"\r\n                onClick={() => {\r\n                  setUpdatedData({});\r\n                  setDoubleClicked({});\r\n                  setPage(old => (!_latestData || !_latestData.hasMore ? old : old + 1))\r\n                }}\r\n                disabled={!_latestData || !_latestData.hasMore}>\r\n          {settings.next_text || 'Next Page'}\r\n\r\n        </button>\r\n      </div> : ''\r\n    }\r\n  </>\r\n};\r\n\r\nexport default AltrpTable\r\n\r\n/**\r\n * Парсинг колонок из настроек в колонки для react-table\r\n * @param settings\r\n * @return {Array}\r\n */\r\nfunction settingsToColumns(settings) {\r\n  let columns = [];\r\n  let { tables_columns } = settings;\r\n  tables_columns = tables_columns || [];\r\n  /**\r\n   * Если в колонке пустые поля, то мы их игнорируем, чтобы не было ошибки\r\n   */\r\n  tables_columns.forEach(_column => {\r\n    if (_column.column_name && _column.accessor) {\r\n      _column._accessor = _column.accessor;\r\n      columns.push(_column);\r\n    }\r\n  });\r\n  return columns;\r\n}\r\n\r\n/**\r\n *\r\n * @param {{}}settings\r\n * @return {string|array}\r\n */\r\nfunction renderAdditionalRows(settings) {\r\n  let { additional_rows } = settings;\r\n  if(! _.isArray(additional_rows)){\r\n    return '';\r\n  }\r\n  return additional_rows.map(row=>{\r\n    row.additional_cells = row.additional_cells || [];\r\n    return<tr key={`additional-row-${row.id}`}>\r\n      {row.additional_cells.map(cell=>{\r\n        cell.rowspan = cell.rowspan || 1;\r\n        cell.colspan = cell.colspan || 1;\r\n        return<th key={`additional-cell-${row.id}-${cell.id}`}\r\n                  role=\"columnheader\"\r\n                  className=\"altrp-table-th\"\r\n                  colSpan={cell.colspan}\r\n                  rowSpan={cell.rowspan}>{cell.title}</th>\r\n      })}\r\n    </tr>\r\n  })\r\n}\r\n\r\n/**\r\n * Отрисовка главного заголовка колонки для таблицы\r\n * @param {{}}column\r\n * @param {{}}sortSetting\r\n * @param {{}}filterSetting\r\n * @param {function}sortingHandler\r\n * @param {function}filterHandler\r\n * @return {*}\r\n */\r\nfunction renderTh({column, sortSetting, sortingHandler, filterSetting, filterHandler}){\r\n  const { column_width, column_header_alignment } = column;\r\n  let thProps = {...column.getHeaderProps()};\r\n  const style = {};\r\n  if (column_width) style.width = column_width;\r\n  if (column_header_alignment) style.textAlign = column_header_alignment;\r\n  thProps.className = 'altrp-table-th';\r\n  if(column.column_is_sorted){\r\n    thProps.onClick = () => sortingHandler(column._accessor);\r\n    thProps.className += ' clickable'\r\n  }\r\n  if(column.column_width){\r\n    thProps.width = column.column_width + '%';\r\n  }\r\n  let thText = column.render('column_name');\r\n  return <th {...thProps} style={style}>\r\n    {thText}\r\n    { sortSetting && column.column_is_sorted && (sortSetting.order_by === column._accessor)\r\n      && (sortSetting.order === \"DESC\" ?\r\n        iconsManager().renderIcon('chevron', {className:'rotate-180 sort-icon '}) :\r\n        iconsManager().renderIcon('chevron', {className: 'sort-icon'}))}\r\n    {column.column_is_filtered &&\r\n    <label className=\"altrp-label\">\r\n    <input type=\"text\"\r\n           onClick={e => {e.stopPropagation()}}\r\n           onChange={e=>{\r\n             e.stopPropagation();\r\n             let value = e.target.value;\r\n             filterHandler(column._accessor, value)\r\n           }}\r\n           value={filterSetting[column._accessor] || ''}\r\n           className=\"altrp-field\"/>\r\n    </label>}\r\n\r\n  </th>\r\n}"],"sourceRoot":""}