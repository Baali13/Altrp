{"version":3,"sources":["webpack:///./resources/modules/editor/src/js/classes/AltrpForm.js","webpack:///./resources/modules/editor/src/js/classes/modules/FormsManager.js"],"names":["AltrpForm","formId","route","method","this","fields","resource","Resource","field","push","success","forEach","fieldValidate","post","getData","put","alert","data","getValue","getSettings","formsManager","forms","formIds","fieldsStorage","modelName","form","getForm","length","setFields","addField","submit","console","error","_form"],"mappings":"+KAuEeA,E,WAjEb,WAAYC,EAAQC,GAAuB,IAAhBC,EAAgB,uDAAP,OAAO,YACzCC,KAAKH,OAASA,EACdG,KAAKC,OAAS,GACdD,KAAKD,OAASA,EACdC,KAAKF,MAAQA,EACbE,KAAKE,SAAW,IAAIC,IAAS,CAACL,U,oDAOtBG,GACRD,KAAKC,OAASA,I,+BAOPG,GAEP,OADAJ,KAAKC,OAAOI,KAAKD,IACV,I,4HAQHE,GAAU,EACdN,KAAKC,OAAOM,SAAQ,SAAAH,GACbA,EAAMI,kBACTF,GAAU,OAGXA,E,sBACON,KAAKD,O,OACN,S,OAGA,Q,uCAFUC,KAAKE,SAASO,KAAKT,KAAKU,W,gEAGxBV,KAAKE,SAASS,IAAIX,KAAKU,W,0FAI3BE,MAAM,uB,uKASrB,IAAIC,EAAO,GAMX,OALAb,KAAKC,OAAOM,SAAQ,SAAAH,GACfA,EAAMU,aACPD,EAAKT,EAAMW,YAAY,aAAeX,EAAMU,eAGzCD,M,KCuBLG,EAAe,I,WArFnB,aAAa,YAKXhB,KAAKiB,MAAQ,GAKbjB,KAAKkB,QAAU,GACflB,KAAKmB,cAAgB,G,iDAUVtB,EAAQuB,EAAWrB,GAC9B,IAAIsB,EAAOrB,KAAKsB,QAAQzB,GACpBC,EAAQ,gBAAH,OAAmBsB,GAa5B,OAZKC,IACHA,EAAO,IAAIzB,EAAUC,EAAQC,EAAOC,GAKjCC,KAAKmB,cAActB,IAAWG,KAAKmB,cAActB,GAAQ0B,SAC1DF,EAAKG,UAAUxB,KAAKmB,cAActB,WAC3BG,KAAKmB,cAActB,IAE5BG,KAAKiB,MAAMZ,KAAKgB,IAEXA,I,+BAUAxB,EAAQO,GACf,IAAIiB,EAAOrB,KAAKsB,QAAQzB,GACxB,OAAKwB,EAKEA,EAAKI,SAASrB,IAJnBJ,KAAKmB,cAActB,GAAUG,KAAKmB,cAActB,IAAW,GAC3DG,KAAKmB,cAActB,GAAQQ,KAAKD,IACzB,K,iCASAP,GACT,OAAKG,KAAKsB,QAAQzB,GAIXG,KAAKsB,QAAQzB,GAAQ6B,UAH1BC,QAAQC,MAAM,qBACP,K,8BASH/B,GACN,IAAIgC,EAAQ,KASZ,OARA7B,KAAKiB,MAAMV,SAAQ,SAAAc,GAIdA,EAAKxB,SAAWA,IACjBgC,EAAQR,MAGLQ,M,MAKIb","file":"eee3543576648aecf96f.bundle.js","sourcesContent":["import Resource from \"./Resource\";\r\n\r\n/**\r\n * Класс имитирующий поведение формы (собирает данные с виджетов полей и отправляет их на сервер)\r\n */\r\nclass AltrpForm {\r\n  constructor(formId, route, method = 'POST'){\r\n    this.formId = formId;\r\n    this.fields = [];\r\n    this.method = method;\r\n    this.route = route;\r\n    this.resource = new Resource({route})\r\n  }\r\n\r\n  /**\r\n   * Устанавливает список полей (в случае, если егистрация после добавления какой либо формы)\r\n   * @param {FrontElement[]}fields\r\n   */\r\n  setFields(fields){\r\n    this.fields = fields;\r\n  }\r\n\r\n  /**\r\n   * Добавлйет поле\r\n   * @param {FrontElement} field\r\n   */\r\n  addField(field){\r\n    this.fields.push(field);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Проверка полей перед отправкой\r\n   * @return {boolean}\r\n   */\r\n  async submit(){\r\n    let success = true;\r\n    this.fields.forEach(field=>{\r\n      if(! field.fieldValidate()){\r\n        success = false;\r\n      }\r\n    });\r\n    if(success){\r\n      switch (this.method){\r\n        case 'POST':{\r\n          return await this.resource.post(this.getData());\r\n        }\r\n        case 'PUT':{\r\n          return await this.resource.put(this.getData());\r\n        }\r\n      }\r\n    } else {\r\n      return await alert('Валидация не прошла');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Собирает данные с полей для отправки\r\n   * @return {object}\r\n   */\r\n  getData(){\r\n    let data = {};\r\n    this.fields.forEach(field=>{\r\n      if(field.getValue()){\r\n        data[field.getSettings('field_id')] = field.getValue();\r\n      }\r\n    });\r\n    return data;\r\n  }\r\n}\r\n\r\nexport default AltrpForm","import AltrpForm from \"../AltrpForm\";\r\n/**\r\n * Класс менеджер форм для фронтенда/редактора\r\n */\r\nclass FormsManager {\r\n  constructor(){\r\n    /**\r\n     *\r\n     * @type {AltrpForm[]}\r\n     */\r\n    this.forms = [];\r\n    /**\r\n     *\r\n     * @type {string[]}\r\n     */\r\n    this.formIds = [];\r\n    this.fieldsStorage = {};\r\n  }\r\n\r\n  /**\r\n   * Регистрирует новую форму.\r\n   * @param {string} formId\r\n   * @param {string} modelName\r\n   * @param {string} method\r\n   * @return {AltrpForm}\r\n   */\r\n  registerForm(formId, modelName, method){\r\n    let form = this.getForm(formId);\r\n    let route = `/ajax/models/${modelName}`;\r\n    if(! form){\r\n      form = new AltrpForm(formId, route, method);\r\n      /**\r\n       * Если в хранилище есть поля для указанной формы,\r\n       * то передаем их в форму, а ссылку удаляем\r\n       */\r\n      if(this.fieldsStorage[formId] && this.fieldsStorage[formId].length){\r\n        form.setFields(this.fieldsStorage[formId]);\r\n        delete this.fieldsStorage[formId]\r\n      }\r\n      this.forms.push(form);\r\n    }\r\n    return form;\r\n  }\r\n\r\n  /**\r\n   * Добавляет поле к форме\r\n   * сохраняет поле в fieldsStorage если форма еще не добавлена\r\n   * @param {string} formId\r\n   * @param {FrontElement} field\r\n   * @return {boolean}\r\n   */\r\n  addField(formId, field){\r\n    let form = this.getForm(formId);\r\n    if(! form){\r\n      this.fieldsStorage[formId] = this.fieldsStorage[formId] || [];\r\n      this.fieldsStorage[formId].push(field);\r\n      return true;\r\n    }\r\n    return form.addField(field)\r\n  }\r\n  /**\r\n   * Отправляет форму\r\n   * @param {string} formId\r\n   * @return {boolean}\r\n   */\r\n  submitForm(formId){\r\n    if(! this.getForm(formId)){\r\n      console.error('Форма не найдена');\r\n      return false;\r\n    }\r\n    return this.getForm(formId).submit();\r\n  }\r\n  /**\r\n   * Получить форму по id\r\n   * @param {string} formId\r\n   * @return {AltrpForm | null}\r\n   */\r\n  getForm(formId){\r\n    let _form = null;\r\n    this.forms.forEach(form=>{\r\n      /**\r\n       * @member {AltrpForm}form\r\n       */\r\n      if(form.formId === formId){\r\n        _form = form;\r\n      }\r\n    });\r\n    return _form;\r\n  }\r\n}\r\nconst formsManager = new FormsManager();\r\n\r\nexport default formsManager;"],"sourceRoot":""}